<!DOCTYPE html>
<html>
<head>
	<title>2019 US Commerical Flight Routes</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta name="apple-mobile-web-app-capable" content="yes">

	<link rel="stylesheet" href="plugins/leaflet/leaflet.css" />
	<script src="plugins/leaflet/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
    <script src='air-data.js'></script>
	<link rel="stylesheet" href="style/style2.css"/>
</head>
<body>	        
	<div id="map" style="width:100%; height:100%; "></div>

<!--
* 2019 air data showing the number of seats flown by airlines on routes that start in the United States
* line weight corresponds to the number of seats available
* routes with 1 million seats flown per year (or more) are shown in red. There are about 50 such routes
* the smallest route shown is one with the annual seats flown between between ORD and ATW. 
-->

	<script>

// Detect if retina display
var isRetina = window.devicePixelRatio > 1;
var retinasuffix = isRetina ? '@2x' : '';

// Use Stamen Toner Lite tiles via Stadia Maps
var baseMap = L.tileLayer('https://tiles.stadiamaps.com/tiles/stamen_toner_lite/{z}/{x}/{y}' + retinasuffix + '.png', {
    attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, under <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a>. Data by <a href="http://openstreetmap.org">OpenStreetMap</a>, under <a href="http://www.openstreetmap.org/copyright">ODbL</a>.',
    maxZoom: 20
})




map = L.map("map", {
	center: [25.878994400196202, -107.49023437500001],
	zoom: 3,
    //minZoom: 4,
    //maxZoom: 10,
	layers: [baseMap],
        zoomControl: true
	});

// Store polylines with their data for zoom-based scaling
var polylines = [];

// Function to calculate zoom multiplier (lines get thicker when zoomed in)
function getZoomMultiplier(zoom) {
	// At zoom 3 (country level), multiplier is 1
	// At zoom 10+ (city level), multiplier is ~5
	return Math.pow(1.25, zoom - 3);
}

// Function to update all line weights based on current zoom
function updateLineWeights() {
	var zoom = map.getZoom();
	var zoomMult = getZoomMultiplier(zoom);

	polylines.forEach(function(item) {
		var baseWeight = 1 * item.data.seats / 2266056 * item.data.mult;
		item.polyline.setStyle({ weight: baseWeight * zoomMult });
	});
}

latlngs.reverse().map(function(l) {


	// fix routes to Japan
	// https://github.com/leaflet/leaflet/issues/82
	if(l.coords[0][1] > 100) {
		l.coords[0][1] = l.coords[0][1] - 360
	}
	if(l.coords[1][1] > 100) {
		l.coords[1][1] = l.coords[1][1] - 360
	}

	var theColor = 'blue'
	var mult = 1

	if (l.seats > 1000000) {
		theColor='red'
		mult = 2
	}

	var baseWeight = 1 * l.seats / 2266056 * mult;
	var zoomMult = getZoomMultiplier(map.getZoom());

	var polyline = L.polyline(l.coords, {
		color: theColor,
		weight: baseWeight * zoomMult,
		opacity:0.5
	}).addTo(map);

	// Store polyline and its data for later updates
	polylines.push({
		polyline: polyline,
		data: { seats: l.seats, mult: mult }
	});
})

// Update line weights when zoom changes
map.on('zoomend', updateLineWeights);

map.attributionControl.addAttribution(' | 2019 air travel data from <a href="https://www.transtats.bts.gov/">Bureau of Transportation Statistics</a>')

// var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);



	</script>
</body>
</html>
