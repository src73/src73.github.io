<!DOCTYPE html>
<html>
<head>
	<title>Radar Loop with Leaflet</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="apple-touch-icon" href="img/radar.png">
	<meta name="apple-mobile-web-app-capable" content="yes">

	<meta http-equiv="refresh" content="300">

	<link rel="stylesheet" href="plugins/leaflet0.7/leaflet.css" />
	<script src="plugins/leaflet0.7/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
	<link rel="stylesheet" href="style/style2.css"/>	
	<script src="//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-image/v0.0.4/leaflet-image.js"></script>
</head>
<body>	        
	<div id="map" style="width:100%; height:100%; "></div>

	<script>
var mapquestOSM = L.tileLayer("http://{s}.tiles.mapbox.com/v3/am3081.h0po4e8k/{z}/{x}/{y}.png");


map = L.map("map", {
	center: [41.57, -88.214],
	zoom: 7,
    //minZoom: 4,
    //maxZoom: 10,
	layers: [mapquestOSM],
        zoomControl: false,
	});
		
var radarLayers = [];
for(var hour = 0; hour <= 10; hour++){  
	console.log("hour = " + hour);
	time = (50)-(hour * 5);
	if (hour < 10) {
	var layer = 'nexrad-n0r-900913-m'+time+'m'
	radarLayers[hour] = L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
			layers: layer,
			format: 'image/png',
			transparent: true,
			opacity: 0.0,
		});
		//console.log(layer);
                radarLayers[hour].addTo(map);

	} 
	if (time == 0) {
		var layer = 'nexrad-n0r-900913'
		radarLayers[hour] = L.tileLayer.wms("http://mesonet.agron.iastate.edu/cgi-bin/wms/nexrad/n0r.cgi", {
		layers: layer,
		format: 'image/png',
		transparent: true,
		opacity: 0.0,
	});
	//console.log(layer);
        radarLayers[hour].addTo(map);
	}
	}

$('#timeSlider').on('change',function(){
	console.log($(this).val());
	radarLayers.map(function(layer){ layer.setOpacity(0)});
	radarLayers[$(this).val()].setOpacity(0.5); 
});

var i = 0;                     //  set your counter to 1

function myLoop () {           //  create a loop function
   setTimeout(function () {    //  call a 3s setTimeout when the loop is called
     console.log(i);
     radarLayers.map(function(layer){ layer.setOpacity(0)});
     radarLayers[i].setOpacity(0.5); 
     $('#timeSlider').val(i);          //  your code here
      i++;                     //  increment the counter
      if (i < 10) {            //  if the counter < 10, call the loop function
         myLoop();             //  ..  again which will trigger another 
      }else{
        i = 0;
	myLoop();
      }                      //  ..  setTimeout()
   }, 500)
}

myLoop();

	</script>
</body>
</html>
